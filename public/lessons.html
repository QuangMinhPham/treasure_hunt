<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Danh s√°ch b√†i h·ªçc | ƒê·∫£o Gi·∫•u V√†ng üèùÔ∏è</title>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="lessons.css">
  
</head>
<body>
  <div class="toolbar">
    <div class="title">
      <i class="fa-solid fa-map-marked-alt"></i>
      <span>ƒê·∫¢O GI·∫§U V√ÄNG ‚Äî B√ÄI H·ªåC</span>
    </div>
    <div>
      <button onclick="location.href='index.html'"><i class="fa-solid fa-house"></i> Trang ch·ªß</button>
    </div>
  </div>

  <div class="page">
    <section id="lesson">
      <div class="btn btn-left" id="btnLeft" title="L√πi"><i class="fa-solid fa-chevron-left"></i></div>
      <div class="main-lesson">
        <div class="slides" id="slidesContainer">
            <!-- slides ƒë∆∞·ª£c ch√®n b·∫±ng JS -->
        </div>
      </div>
      <div class="btn btn-right" id="btnRight" title="Ti·∫øn"><i class="fa-solid fa-chevron-right"></i></div>
    </section>
  </div>


  <!-- <script>
    const slidesContainer = document.getElementById("slidesContainer");
    const API_URL = "/api/lessons";

    // ======= L·∫•y d·ªØ li·ªáu b√†i h·ªçc t·ª´ server =======
    async function loadLessons() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        renderLessons(data.lessons);
      } catch (err) {
        console.error("L·ªói khi t·∫£i b√†i h·ªçc:", err);
      }
    }

    // ======= Hi·ªÉn th·ªã danh s√°ch b√†i h·ªçc =======
    function renderLessons(lessons) {
      slidesContainer.innerHTML = "";
      lessons.forEach((lesson) => {
        const slide = document.createElement("div");
        slide.className = "slide";
        slide.dataset.chapter = lesson.chapter_id;
        slide.innerHTML = `
          <div class="lesson-img">
            <img class="lesson-image" src="images/${lesson.chapter_id}.jpg" alt="banner" draggable="false">
          </div>
          <div class="lesson-name">
            <div class="lesson-number">B√†i ${lesson.chapter_id}</div>
            <div class="lesson-title">${lesson.title}</div>
          </div>
        `;

        slidesContainer.appendChild(slide);
      });

      initSlideEvents();
    }

    // ======= Slide cu·ªôn ngang + x·ª≠ l√Ω drag/click =======
    function initSlideEvents() {
      const slides = document.querySelector(".slides");
      const slide = document.querySelectorAll(".slide");
      const btnleft = document.querySelector(".btn-left");
      const btnright = document.querySelector(".btn-right");
      let index = 0;

      // --- Flags ƒë·ªÉ x√°c ƒë·ªãnh k√©o/nh·∫•p ---
      let isDown = false;
      let startX = 0;
      let scrollLeft = 0;
      let wasDragging = false;      // c√≥ k√©o kh√¥ng
      let leftWhileDown = false;    // c√≥ r·ªùi v√πng slider khi ƒëang gi·ªØ kh√¥ng

      const updateSlide = () => {
        let width = slide[0].offsetWidth;
        let margin = parseInt(getComputedStyle(slide[0]).marginRight) || 0;
        slides.style.transform = `translateX(${-(width + margin * 2) * index}px)`;
        document.querySelector(".active")?.classList.remove("active");
        slide[index].classList.add("active");
      };

      // --- N√∫t ƒëi·ªÅu h∆∞·ªõng ---
      btnright.addEventListener("click", () => {
        index++;
        if (index === slide.length) index = 0;
        updateSlide();
      });

      btnleft.addEventListener("click", () => {
        index--;
        if (index < 0) index = slide.length - 1;
        updateSlide();
      });

      // --- K√©o b·∫±ng chu·ªôt ---
      const slider = document.querySelector(".main-lesson");

      slider.addEventListener("mousedown", (e) => {
        isDown = true;
        wasDragging = false;
        leftWhileDown = false;
        startX = e.pageX - slider.offsetLeft;
        scrollLeft = slider.scrollLeft;
      });

      slider.addEventListener("mouseleave", (e) => {
        if (isDown) leftWhileDown = true;
        isDown = false;
      });

      slider.addEventListener("mouseup", (e) => {
        isDown = false;
        setTimeout(() => {
          wasDragging = false;
          leftWhileDown = false;
        }, 50);
      });

      slider.addEventListener("mousemove", (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        const walk = (x - startX) * 2; // t·ªëc ƒë·ªô k√©o
        if (Math.abs(x - startX) > 5) wasDragging = true;
        slider.scrollLeft = scrollLeft - walk;
      });

      // --- Click ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng ---
      slidesContainer.addEventListener("click", (e) => {
        const slideEl = e.target.closest(".slide");
        if (!slideEl) return;

        // N·∫øu v·ª´a k√©o ho·∫∑c r·ªùi v√πng => kh√¥ng chuy·ªÉn trang
        if (wasDragging || leftWhileDown) {
          e.stopPropagation();
          return;
        }

        const chapterId = slideEl.dataset.chapter;
        if (chapterId) {
          window.location.href = `challenges.html?chapter_id=${chapterId}`;
        }
      });
    }

    // ======= Kh·ªüi ch·∫°y =======
    loadLessons();
</script>
 -->

<script>
  const slidesContainer = document.getElementById("slidesContainer");
  const API_URL = "/api/lessons";

  // ======= L·∫•y d·ªØ li·ªáu b√†i h·ªçc t·ª´ server =======
  async function loadLessons() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      renderLessons(data.lessons);
    } catch (err) {
      console.error("L·ªói khi t·∫£i b√†i h·ªçc:", err);
    }
  }

  // ======= Hi·ªÉn th·ªã danh s√°ch b√†i h·ªçc =======
  function renderLessons(lessons) {
    slidesContainer.innerHTML = "";
    lessons.forEach((lesson) => {
      const slide = document.createElement("div");
      slide.className = "slide";
      slide.dataset.chapter = lesson.chapter_id;

      slide.innerHTML = `
        <div class="lesson-img">
          <img class="lesson-image" 
               src="images/${lesson.chapter_id}.jpg" 
               alt="banner" 
               draggable="false" 
               ondragstart="return false;">
        </div>
        <div class="lesson-name">
          <div class="lesson-number">B√†i ${lesson.chapter_id}</div>
          <div class="lesson-title">${lesson.title}</div>
        </div>
      `;

      slidesContainer.appendChild(slide);
    });

    initSlideEvents();
  }

  // ======= Slide cu·ªôn ngang + x·ª≠ l√Ω drag/click =======
  function initSlideEvents() {
    const slides = document.querySelector(".slides");
    const slide = document.querySelectorAll(".slide");
    const btnleft = document.querySelector(".btn-left");
    const btnright = document.querySelector(".btn-right");
    const slider = document.querySelector(".main-lesson");

    let index = 0;
    let isDown = false;
    let startX = 0;
    let scrollLeft = 0;
    let wasDragging = false;
    let leftWhileDown = false;

    const updateSlide = () => {
      let width = slide[0].offsetWidth;
      let margin = parseInt(getComputedStyle(slide[0]).marginRight) || 0;
      slides.style.transform = `translateX(${-(width + margin * 2) * index}px)`;
      document.querySelector(".active")?.classList.remove("active");
      slide[index].classList.add("active");
    };

    // --- N√∫t chuy·ªÉn ---
    btnright.addEventListener("click", () => {
      index = (index + 1) % slide.length;
      updateSlide();
    });

    btnleft.addEventListener("click", () => {
      index = (index - 1 + slide.length) % slide.length;
      updateSlide();
    });

    // --- K√©o chu·ªôt ƒë·ªÉ cu·ªôn ---
    slider.addEventListener("mousedown", (e) => {
      isDown = true;
      wasDragging = false;
      leftWhileDown = false;
      startX = e.pageX;
      scrollLeft = slider.scrollLeft;
      slider.classList.add("active");
    });

    slider.addEventListener("mouseleave", () => {
      if (isDown) leftWhileDown = true;
      isDown = false;
      slider.classList.remove("active");
    });

    slider.addEventListener("mouseup", () => {
      isDown = false;
      slider.classList.remove("active");
      setTimeout(() => {
        wasDragging = false;
        leftWhileDown = false;
      }, 50);
    });

    slider.addEventListener("mousemove", (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX;
      const walk = (x - startX) * 1.5; // t·ªëc ƒë·ªô cu·ªôn
      if (Math.abs(x - startX) > 5) wasDragging = true;
      slider.scrollLeft = scrollLeft - walk;
    });

    // --- Click ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng ---
    slidesContainer.addEventListener("click", (e) => {
      const slideEl = e.target.closest(".slide");
      if (!slideEl) return;

      if (wasDragging || leftWhileDown) {
        e.stopPropagation();
        return;
      }

      const chapterId = slideEl.dataset.chapter;
      if (chapterId) {
        window.location.href = `challenges.html?chapter_id=${chapterId}`;
      }
    });
  }

  // ======= Kh·ªüi ch·∫°y =======
  loadLessons();
</script>


</body>
</html>
