<!DOCTYPE html>
<html lang="en">
<head>
	<title>Slide Navbar</title>
	<link rel="stylesheet" type="text/css" href="/login.css">
<link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
</head>
<body>
	<video class="bg-video" autoplay muted loop playsinline poster="images/background2.mp4" preload="auto">
    	<source src="images/background2.mp4" type="video/mp4">
  	</video>
	<div class="main">  	
		<input type="checkbox" id="chk" aria-hidden="true">

			<div class="signup">
				<form id="user-signup" method="post">
					<div class="signup-label">Đăng Ký</div>
					<input type="text" name="name" placeholder="User name" required="">
					<input type="email" name="email" placeholder="Email" required="">
					<input type="password" name="password" placeholder="Password" required="">
					<button type="submit">Sign up</button>
					<label for="chk" >Đã có tài khoản? Đăng nhập ngay</label>
				</form>
			</div>

			<div class="login">
				<form id="user-signin" method="post">
					<div class="signin-label">Đăng Nhập</div>
					<input type="email" name="email" placeholder="Email" required="">
					<input type="password" name="password" placeholder="Password" required="">
					<button type="submit">Login</button>
					<label for="chk" >Chưa có tài khoản? Đăng ký ngay</label>
				</form>
			</div>

			<div class="img_login">

			</div>
	</div>
	<script>
		document.getElementById('user-signup').addEventListener('submit',async(event)=>{
				event.preventDefault();
				const formdata = new FormData(event.target);
				const data = Object.fromEntries(formdata);
				const response = await fetch('/auth/add-user',{
					method:'POST',
					headers:{
						'Content-Type':'application/json',
					},
					body: JSON.stringify(data),
				})
				const result = await response.text()
				alert(result)
			}
		)
			document.getElementById('user-signin').addEventListener('submit', async (event) => {
			event.preventDefault();
			const formdata = new FormData(event.target);
			const data = Object.fromEntries(formdata);
			const response = await fetch('/auth/login', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(data),
			});

			const result = await response.json();
			if (!response.ok) {
				alert("Error: " + result);
				return;
			}
			alert(result.message);
			localStorage.setItem('token', result.token);
			if(result.URL_directLink) {
				console.log(result.URL_directLink)
				const res = await fetch('http://localhost:3000/admin', {
					method: "GET",
					headers: {
						'Authorization': `Bearer ${result.token}`,
					},
				})
				if(!res.ok) {
					alert("Error123: " + result);
					return;
				} else {
					window.location.href = result.URL_directLink
				}
			}
			else {
				window.location.href = '/';
			}
		});
	</script>
</body>
</html>